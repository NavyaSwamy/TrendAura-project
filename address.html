<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrendAura - Delivery Address</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Georgia', sans-serif;
        }

        body {
            background-color: #f8f9fa;
            color: #333;
            padding-top: 10px;
        }
        /* Header Styles */
        .header {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 2rem 5%;
            max-width: 1400px;
            margin: 0 auto;
        }

        .menu-left {
            display: flex;
            gap: 2rem;
        }

        .menu-left a {
            text-decoration: none;
            color: #555;
            font-weight: 500;
            transition: all 0.3s;
        }

        .menu-left a:hover, .menu-left a.active {
            color: #e83e8c;
        }

        .logo {
            font-size: 2.2rem;
            font-weight: 700;
            color: #e83e8c;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .menu-right {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .search-container {
            display: flex;
            gap: 3rem;
        }

        .search-container select, 
        .search-container input {
            padding: 0.6rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .search-btn {
            background: #e83e8c;
            color: white;
            border: none;
            padding: 0 1rem;
            border-radius: 4px;
            cursor: pointer;
        }

        .action-icons {
            display: flex;
            gap: 1.2rem;
        }

        .icon {
            position: relative;
            cursor: pointer;
            font-size: 1.2rem;
            color: #555;
            transition: all 0.3s;
        }

        .icon:hover {
            color: #e83e8c;
        }

        .tooltip {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            font-size: 0.7rem;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .icon:hover .tooltip {
            opacity: 1;
        }

        .badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #e83e8c;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.6rem;
            font-weight: bold;
        }
         /* Remove the old icon-text */
        .icon-text {
            display: none;
        }

        /* Improve tooltip positioning */
        .icon-group {
            position: relative;
            display: inline-block;
        }

        .icon-group .tooltip {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            font-size: 0.7rem;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            margin-top: 5px;
        }

        .icon-group:hover .tooltip {
            opacity: 1;
        }
        /* Adjust the gap between icons */
        .action-icons {
            display: flex;
            gap: 3rem; /* Increase this value for more space */
            align-items: center;
        }

        /* Ensure icons and badges are properly aligned */
        .icon-group {
            position: relative;
            display: inline-block;
            text-align: center; /* Center-align icons and tooltips */
        }

        /* Optional: Adjust icon size if needed */
        .icon {
            font-size: 1.2rem;
            color: #555;
            transition: all 0.3s;
        }
        /* Add your existing styles here */
        .checkout-container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 0 5%;
        }
        
        .address-form {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .section-title {
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
            color: #e83e8c;
            position: relative;
            padding-bottom: 10px;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background: #e83e8c;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
            position: relative;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            border-color: #e83e8c;
            outline: none;
        }
        
        .form-row {
            display: flex;
            gap: 1rem;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .btn {
            background: #e83e8c;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: background-color 0.3s;
            display: inline-block;
            text-align: center;
        }
        
        .btn:hover {
            background: #d2337a;
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid #e83e8c;
            color: #e83e8c;
            margin-right: 1rem;
        }
        
        .btn-outline:hover {
            background: #fff0f5;
        }
        
        .action-buttons {
            display: flex;
            margin-top: 2rem;
        }

        /* Saved Addresses Styles */
        .saved-addresses {
            margin-bottom: 2rem;
        }

        .address-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .address-card {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .address-card:hover {
            border-color: #e83e8c;
            box-shadow: 0 2px 8px rgba(232, 62, 140, 0.1);
        }

        .address-card.selected {
            border: 2px solid #e83e8c;
            background-color: #fff0f5;
        }

        .address-card .address-type {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #e83e8c;
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .address-card .address-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .address-card .address-details {
            color: #555;
            line-height: 1.5;
        }

        .address-card .use-this-btn {
            margin-top: 0.5rem;
            background: #e83e8c;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .add-new-address {
            margin-top: 1rem;
            color: #e83e8c;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .add-new-address i {
            font-size: 1.2rem;
        }

        /* Validation Styles */
        .error-message {
            color: #dc3545;
            font-size: 0.8rem;
            margin-top: 0.3rem;
            display: none;
        }

        .form-control.error {
            border-color: #dc3545;
        }

        .form-control.success {
            border-color: #28a745;
        }

        /* Toggle between saved addresses and new address form */
        .new-address-form {
            display: none;
        }

        .show-form .new-address-form {
            display: block;
        }

        .show-form .saved-addresses {
            display: none;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 1rem;
            }
            
            .btn-outline {
                margin-right: 0;
                margin-bottom: 1rem;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="navbar">
            <div class="menu-left">
                <a href="index.html">Home</a>
                <a href="collections.html">All Collections</a>
                <a href="contact.html">Contact</a>
                <a href="Q&A.html">Q&A</a>
                <a href="about.html">About Us</a>
            </div>
            <h1 class="logo">TREND AURA</h1>
            <div class="menu-right">
                <div class="action-icons">
                    <div class="search-container">
                    <div class="icon-group" id="searchTrigger">
                        <a href="collections1.html">
                            <div class="icon search-icon"><i class="fas fa-search"></i></div>
                            <div class="tooltip">Search</div>
                        </a>
                    </div>
                    <div class="icon-group" title="Wishlist">
                        <a href="wishlist1.html">
                            <i class="far fa-heart icon"></i>
                            <span class="badge" id="wishlist-badge">0</span>
                            <div class="tooltip">Wishlist</div>
                        </a>
                    </div>
                    
                    <div class="icon-group" title="Cart">
                        <a href="cart.html" aria-hidden="true"></i>
                            <i class="fas fa-shopping-cart icon"></i>
                            <span class="badge" id="cart-badge">0</span>
                            <div class="tooltip">Cart</div>
                        </a>
                    </div>
                    <div class="icon-group" title="Account">
                        <a href="profile.html">
                            <i class="fas fa-user icon"></i>
                            <div class="tooltip">Profile</div>
                        </a>
                    </div>
                    <div class="icon-group">
                        <a href="#" id="logout-btn" style="color: inherit;">
                            <i class="fas fa-sign-out-alt icon"></i>
                            <div class="tooltip">Logout</div>
                        </a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <!-- Address Content -->
    <div class="checkout-container">
        <div class="address-form">
            <h2 class="section-title">Delivery Address</h2>
            
            <!-- Saved Addresses Section -->
            <div class="saved-addresses">
                <h3>Your Saved Addresses</h3>
                <div class="address-list" id="address-list">
                    <!-- Address cards will be dynamically inserted here -->
                </div>
                <div class="add-new-address" id="show-new-address-form">
                    <i class="fas fa-plus"></i>
                    <span>Add New Address</span>
                </div>
            </div>
            
            <!-- New Address Form (hidden by default) -->
            <form id="delivery-address-form" class="new-address-form">
                <div class="form-group">
                    <label for="full-name">Full Name *</label>
                    <input type="text" id="full-name" class="form-control" required>
                    <span class="error-message">Please enter your full name</span>
                </div>
                
                <div class="form-group">
                    <label for="phone">Phone Number *</label>
                    <input type="tel" id="phone" class="form-control" required>
                    <span class="error-message">Please enter a valid phone number</span>
                </div>
                
                <div class="form-group">
                    <label for="street">Street Address *</label>
                    <input type="text" id="street" class="form-control" required>
                    <span class="error-message">Please enter your street address</span>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="village">Village/Town *</label>
                        <input type="text" id="village" class="form-control" required>
                        <span class="error-message">Please enter your village/town</span>
                    </div>
                    <div class="form-group">
                        <label for="mandal">Mandal *</label>
                        <input type="text" id="mandal" class="form-control" required>
                        <span class="error-message">Please enter your mandal</span>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="district">District *</label>
                        <input type="text" id="district" class="form-control" required>
                        <span class="error-message">Please enter your district</span>
                    </div>
                    <div class="form-group">
                        <label for="state">State *</label>
                        <input type="text" id="state" class="form-control" required>
                        <span class="error-message">Please enter your state</span>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="pincode">Pincode *</label>
                        <input type="text" id="pincode" class="form-control" required>
                        <span class="error-message">Please enter a valid pincode</span>
                    </div>
                    <div class="form-group">
                        <label for="country">Country *</label>
                        <input type="text" id="country" class="form-control" value="India" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="landmark">House Identification/Landmark *</label>
                    <textarea id="landmark" class="form-control" rows="3" required></textarea>
                    <small>Example: "Blue house near temple", "House No. 12-34", etc.</small>
                    <span class="error-message">Please enter a landmark</span>
                </div>
                
                <div class="form-group">
                    <label for="address-type">Address Type</label>
                    <select id="address-type" class="form-control">
                        <option value="home">Home (All day delivery)</option>
                        <option value="work">Work (Delivery between 9AM-5PM)</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <input type="checkbox" id="save-address" checked>
                    <label for="save-address">Save this address for future use</label>
                </div>
                
                <div class="action-buttons">
                    <button type="button" id="back-to-saved" class="btn btn-outline">Back to Saved Addresses</button>
                    <button type="submit" class="btn">Proceed to Payment</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Load user data and pre-fill form
        function loadUserData() {
            // Check if user is logged in
            const isLoggedIn = localStorage.getItem('isAuthenticated') === 'true';
            
            if (!isLoggedIn) {
                // Redirect to login page if not logged in
                window.location.href = 'login.html';
                return;
            }

            // Load user data
            const user = JSON.parse(localStorage.getItem('currentUser'));
            
            if (!user) {
                // If no user data, redirect to login
                window.location.href = 'login.html';
                return;
            }
            
            // Load saved addresses
            const savedAddresses = JSON.parse(localStorage.getItem('savedAddresses') || '[]');
            displaySavedAddresses(savedAddresses);
            
            // If no saved addresses, show the form immediately
            if (savedAddresses.length === 0) {
                document.querySelector('.address-form').classList.add('show-form');
            }
        }
        
        // Display saved addresses
        function displaySavedAddresses(addresses) {
            const addressList = document.getElementById('address-list');
            addressList.innerHTML = '';
            
            if (addresses.length === 0) {
                addressList.innerHTML = '<p>No saved addresses found. Please add a new address.</p>';
                document.querySelector('.address-form').classList.add('show-form');
                return;
            }
            
            addresses.forEach((address, index) => {
                const addressCard = document.createElement('div');
                addressCard.className = 'address-card';
                addressCard.dataset.index = index;
                
                let addressTypeBadge = '';
                if (address.type === 'home') {
                    addressTypeBadge = '<span class="address-type">Home</span>';
                } else if (address.type === 'work') {
                    addressTypeBadge = '<span class="address-type" style="background:#007bff;">Work</span>';
                } else {
                    addressTypeBadge = '<span class="address-type" style="background:#6c757d;">Other</span>';
                }
                
                addressCard.innerHTML = `
                    ${addressTypeBadge}
                    <div class="address-name">${address.fullName} • ${address.phone}</div>
                    <div class="address-details">
                        ${address.street ? address.street + ', ' : ''}
                        ${address.village}, ${address.mandal},<br>
                        ${address.district}, ${address.state},<br>
                        ${address.pincode}<br>
                        ${address.landmark ? '<strong>Landmark:</strong> ' + address.landmark : ''}
                    </div>
                    <button class="use-this-btn">Use This Address</button>
                `;
                
                addressCard.querySelector('.use-this-btn').addEventListener('click', function(e) {
                    e.stopPropagation();
                    saveSelectedAddress(address);
                });
                
                addressCard.addEventListener('click', function() {
                    // Remove selected class from all cards
                    document.querySelectorAll('.address-card').forEach(card => {
                        card.classList.remove('selected');
                    });
                    // Add selected class to clicked card
                    this.classList.add('selected');
                });
                
                addressList.appendChild(addressCard);
            });
        }
        
        // Save selected address and proceed to payment
        function saveSelectedAddress(address) {
            localStorage.setItem('deliveryAddress', JSON.stringify(address));
            window.location.href = 'payment.html';
        }
        
        // Handle form submission
        document.getElementById('delivery-address-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Validate form
            if (!validateForm()) {
                return;
            }
            
            // Get address details
            const address = {
                fullName: document.getElementById('full-name').value.trim(),
                phone: document.getElementById('phone').value.trim(),
                street: document.getElementById('street').value.trim(),
                village: document.getElementById('village').value.trim(),
                mandal: document.getElementById('mandal').value.trim(),
                district: document.getElementById('district').value.trim(),
                state: document.getElementById('state').value.trim(),
                pincode: document.getElementById('pincode').value.trim(),
                country: document.getElementById('country').value.trim(),
                landmark: document.getElementById('landmark').value.trim(),
                type: document.getElementById('address-type').value
            };
            
            // Save to localStorage
            localStorage.setItem('deliveryAddress', JSON.stringify(address));
            
            // Save to addresses if checkbox is checked
            if (document.getElementById('save-address').checked) {
                const savedAddresses = JSON.parse(localStorage.getItem('savedAddresses') || '[]');
                savedAddresses.push(address);
                localStorage.setItem('savedAddresses', JSON.stringify(savedAddresses));
            }
            
            // Redirect to payment page
            window.location.href = 'payment.html';
        });
        
        // Form validation
        function validateForm() {
            let isValid = true;
            const requiredFields = [
                'full-name', 'phone', 'street', 'village', 'mandal', 
                'district', 'state', 'pincode', 'landmark'
            ];
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                const errorMessage = field.nextElementSibling;
                
                if (field.value.trim() === '') {
                    field.classList.add('error');
                    errorMessage.style.display = 'block';
                    isValid = false;
                } else {
                    field.classList.remove('error');
                    errorMessage.style.display = 'none';
                }
            });
            
            // Validate phone number
            const phone = document.getElementById('phone');
            const phoneError = phone.nextElementSibling;
            const phoneRegex = /^[0-9]{10}$/;
            
            if (!phoneRegex.test(phone.value.trim())) {
                phone.classList.add('error');
                phoneError.textContent = 'Please enter a valid 10-digit phone number';
                phoneError.style.display = 'block';
                isValid = false;
            } else {
                phone.classList.remove('error');
                phoneError.style.display = 'none';
            }
            
            // Validate pincode
            const pincode = document.getElementById('pincode');
            const pincodeError = pincode.nextElementSibling;
            const pincodeRegex = /^[0-9]{6}$/;
            
            if (!pincodeRegex.test(pincode.value.trim())) {
                pincode.classList.add('error');
                pincodeError.textContent = 'Please enter a valid 6-digit pincode';
                pincodeError.style.display = 'block';
                isValid = false;
            } else {
                pincode.classList.remove('error');
                pincodeError.style.display = 'none';
            }
            
            return isValid;
        }
        
        // Toggle between saved addresses and new address form
        document.getElementById('show-new-address-form').addEventListener('click', function() {
            document.querySelector('.address-form').classList.add('show-form');
        });
        
        document.getElementById('back-to-saved').addEventListener('click', function() {
            document.querySelector('.address-form').classList.remove('show-form');
        });
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadUserData();
            
            // Set cart/wishlist badge counts
            document.getElementById('cart-badge').textContent = JSON.parse(localStorage.getItem('cart') || '[]').length;
            document.getElementById('wishlist-badge').textContent = JSON.parse(localStorage.getItem('wishlist') || '[]').length;
            
            // Logout functionality
            document.getElementById('logout-btn').addEventListener('click', function(e) {
                e.preventDefault();
                localStorage.removeItem('isAuthenticated');
                localStorage.removeItem('currentUser');
                window.location.href = 'login.html';
            });
        });
        // Set cart/wishlist badge counts
        document.getElementById('cart-badge').textContent = JSON.parse(localStorage.getItem('cart') || '[]').length;
        document.getElementById('wishlist-badge').textContent = JSON.parse(localStorage.getItem('wishlist') || '[]').length;
    </script>
    <iframe src="footer.html" style="width:100%; height:300px; border:none;"></iframe>
</body>
</html>